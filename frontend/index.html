<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Distance Matrix Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .main-content {
            display: flex;
            min-height: 80vh;
        }

        .sidebar {
            width: 350px;
            background: #f8f9fa;
            border-right: 2px solid #e9ecef;
            padding: 20px;
            overflow-y: auto;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }

        .toolbar {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .grid-container {
            flex: 1;
            padding: 20px;
            position: relative;
            overflow: auto;
        }

        #warehouse-grid {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: #ffffff;
            position: relative;
            cursor: crosshair;
        }

        .grid-cell {
            position: absolute;
            border: 1px solid #e9ecef;
            opacity: 0.3;
        }

        .machine {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #28a745, #20c997);
            border: 2px solid #ffffff;
            border-radius: 8px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
        }

        .machine:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .loading-dock {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: 2px solid #ffffff;
            border-radius: 8px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
            transition: all 0.3s ease;
        }

        .loading-dock:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        .unloading-dock {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #dc3545, #c82333);
            border: 2px solid #ffffff;
            border-radius: 8px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
            transition: all 0.3s ease;
        }

        .unloading-dock:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .distance-matrix {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow: auto;
        }

        .coordinates-display {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
        }

        .status-bar {
            background: #495057;
            color: white;
            padding: 10px 20px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grid-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
        }

        .benchmark-item {
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .benchmark-item:hover {
            background: #e3f2fd;
            border-color: #007bff;
        }

        .benchmark-item.selected {
            background: #007bff;
            color: white;
            border-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ Warehouse Distance Matrix Generator</h1>
            <p>Interactive layout designer for genetic algorithm optimization</p>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <!-- Benchmark Selection -->
                <div class="section">
                    <h3>üìä Benchmark Selection</h3>
                    <div id="benchmark-list">
                        <div class="benchmark-item" data-benchmark="4x4">
                            <strong>4x4 Benchmark</strong><br>
                            <small>4 machines, 4 jobs</small>
                        </div>
                        <div class="benchmark-item" data-benchmark="6x6">
                            <strong>6x6 Benchmark</strong><br>
                            <small>6 machines, 6 jobs</small>
                        </div>
                        <div class="benchmark-item" data-benchmark="8x8">
                            <strong>8x8 Benchmark</strong><br>
                            <small>8 machines, 8 jobs</small>
                        </div>
                        <div class="benchmark-item" data-benchmark="10x10">
                            <strong>10x10 Benchmark</strong><br>
                            <small>10 machines, 10 jobs</small>
                        </div>
                    </div>
                </div>

                <!-- AMR Configuration -->
                <div class="section">
                    <h3>ü§ñ AMR Configuration</h3>
                    <div class="form-group">
                        <label for="num-amrs">Number of AMRs:</label>
                        <input type="number" id="num-amrs" class="form-control" value="2" min="1" max="10">
                    </div>
                </div>

                <!-- Genetic Algorithm Parameters -->
                <div class="section">
                    <h3>üß¨ Genetic Algorithm Parameters</h3>
                    <div class="form-group">
                        <label for="crossover-prob">Crossover Probability (Pc):</label>
                        <input type="number" id="crossover-prob" class="form-control" value="0.7" min="0" max="1" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="mutation-prob">Mutation Probability (Pm):</label>
                        <input type="number" id="mutation-prob" class="form-control" value="0.5" min="0" max="1" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="population-size">Population Size (N):</label>
                        <input type="number" id="population-size" class="form-control" value="250" min="10" max="1000">
                    </div>
                    <div class="form-group">
                        <label for="termination-limit">Termination Limit:</label>
                        <input type="number" id="termination-limit" class="form-control" value="300" min="50" max="1000">
                    </div>
                    <div class="form-group">
                        <label for="stagnation-limit">Stagnation Limit:</label>
                        <input type="number" id="stagnation-limit" class="form-control" value="50" min="10" max="200">
                    </div>
                </div>

                <!-- Coordinates Display -->
                <div class="section">
                    <h3>üìç Current Coordinates</h3>
                    <div id="coordinates-display" class="coordinates-display">
                        <div>Machines: None</div>
                        <div>Loading Dock: None</div>
                        <div>Unloading Dock: None</div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="section">
                    <h3>‚ö° Actions</h3>
                    <button class="btn btn-success" style="width: 100%; margin-bottom: 10px;" onclick="generateDistanceMatrix()">
                        Generate Distance Matrix
                    </button>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="exportToGA()">
                        Export to GA Algorithm
                    </button>
                    <button class="btn btn-danger" style="width: 100%;" onclick="clearLayout()">
                        Clear Layout
                    </button>
                </div>

                <!-- Distance Matrix Display -->
                <div class="section">
                    <h3>üìà Distance Matrix</h3>
                    <div id="distance-matrix-display" class="distance-matrix">
                        Distance matrix will appear here after generation...
                    </div>
                </div>
            </div>

            <div class="workspace">
                <div class="toolbar">
                    <button class="btn btn-primary" onclick="addMachine()">+ Add Machine</button>
                    <button class="btn btn-danger" onclick="removeMachine()">- Remove Machine</button>
                    <span class="grid-info">
                        Grid Size: 40x40 units | Click to place items | Drag to move
                    </span>
                </div>
                
                <div class="grid-container">
                    <canvas id="warehouse-grid" width="800" height="600"></canvas>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <span id="status-text">Ready - Select a benchmark and start placing machines</span>
            <span id="machine-count">Machines: 0 | Loading Dock: ‚ùå | Unloading Dock: ‚ùå</span>
        </div>
    </div>

    <script>

        // Load benchmark names into dropdown
        fetch('benchmarks.json')
            .then(response => response.json())
            .then(data => {
            const benchmarkSelect = document.getElementById('benchmarkSelect');
            benchmarkSelect.innerHTML = ''; // Clear old options

            // Populate options
            for (let key in data) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                benchmarkSelect.appendChild(option);
            }

            // Optional: auto-select the first benchmark and load its data
            benchmarkSelect.value = Object.keys(data)[0];
            loadBenchmarkData(data[benchmarkSelect.value]);

            // Handle user selection
            benchmarkSelect.addEventListener('change', () => {
                const selectedData = data[benchmarkSelect.value];
                loadBenchmarkData(selectedData);
            });
            });

        // Function to use the benchmark data
        function loadBenchmarkData(benchmark) {
            // You can now use benchmark.machine_data and benchmark.ptime_data
            console.log('Selected Benchmark:', benchmark);
            
            // Example: you might update a table, send to backend, etc.
        }

        // Global variables
        let canvas = document.getElementById('warehouse-grid');
        let ctx = canvas.getContext('2d');
        let gridSize = 40;
        let machines = [];
        let loadingDock = null;
        let unloadingDock = null;
        let selectedBenchmark = null;
        let isDragging = false;
        let dragItem = null;
        let dragOffset = { x: 0, y: 0 };
        let machineCounter = 0;

        // Initialize grid
        function initializeGrid() {
            drawGrid();
            // Add default loading and unloading docks
            loadingDock = { x: 120, y: 120, type: 'loading' };
            unloadingDock = { x: 320, y: 120, type: 'unloading' };
            updateDisplay();
        }

        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid lines
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw items
            drawMachines();
            drawDocks();
        }

        function drawMachines() {
            machines.forEach((machine, index) => {
                ctx.fillStyle = machine.selected ? '#20c997' : '#28a745';
                ctx.fillRect(machine.x, machine.y, gridSize, gridSize);
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(machine.x, machine.y, gridSize, gridSize);
                
                // Draw machine number
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(machine.id.toString(), machine.x + gridSize/2, machine.y + gridSize/2 + 5);
            });
        }

        function drawDocks() {
            if (loadingDock) {
                ctx.fillStyle = '#007bff';
                ctx.fillRect(loadingDock.x, loadingDock.y, gridSize, gridSize);
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(loadingDock.x, loadingDock.y, gridSize, gridSize);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('LOAD', loadingDock.x + gridSize/2, loadingDock.y + gridSize/2 + 3);
            }
            
            if (unloadingDock) {
                ctx.fillStyle = '#dc3545';
                ctx.fillRect(unloadingDock.x, unloadingDock.y, gridSize, gridSize);
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(unloadingDock.x, unloadingDock.y, gridSize, gridSize);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('UNLOAD', unloadingDock.x + gridSize/2, unloadingDock.y + gridSize/2 + 3);
            }
        }

        function snapToGrid(x, y) {
            return {
                x: Math.floor(x / gridSize) * gridSize,
                y: Math.floor(y / gridSize) * gridSize
            };
        }

        function addMachine() {
            const pos = snapToGrid(100 + (machines.length * 60), 200);
            machines.push({
                id: machineCounter++,
                x: pos.x,
                y: pos.y,
                selected: false
            });
            updateDisplay();
            updateStatus(`Machine ${machineCounter - 1} added`);
        }

        function removeMachine() {
            if (machines.length > 0) {
                const removed = machines.pop();
                updateDisplay();
                updateStatus(`Machine ${removed.id} removed`);
            }
        }

        function getItemAt(x, y) {
            // Check machines
            for (let machine of machines) {
                if (x >= machine.x && x <= machine.x + gridSize &&
                    y >= machine.y && y <= machine.y + gridSize) {
                    return { type: 'machine', item: machine };
                }
            }
            
            // Check docks
            if (loadingDock && x >= loadingDock.x && x <= loadingDock.x + gridSize &&
                y >= loadingDock.y && y <= loadingDock.y + gridSize) {
                return { type: 'loading', item: loadingDock };
            }
            
            if (unloadingDock && x >= unloadingDock.x && x <= unloadingDock.x + gridSize &&
                y >= unloadingDock.y && y <= unloadingDock.y + gridSize) {
                return { type: 'unloading', item: unloadingDock };
            }
            
            return null;
        }

        // Mouse events
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const item = getItemAt(x, y);
            if (item) {
                isDragging = true;
                dragItem = item;
                dragOffset.x = x - item.item.x;
                dragOffset.y = y - item.item.y;
                canvas.style.cursor = 'grabbing';
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (isDragging && dragItem) {
                const newPos = snapToGrid(x - dragOffset.x, y - dragOffset.y);
                dragItem.item.x = Math.max(0, Math.min(newPos.x, canvas.width - gridSize));
                dragItem.item.y = Math.max(0, Math.min(newPos.y, canvas.height - gridSize));
                drawGrid();
            } else {
                const item = getItemAt(x, y);
                canvas.style.cursor = item ? 'grab' : 'default';
            }
        });

        canvas.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                dragItem = null;
                canvas.style.cursor = 'default';
                updateDisplay();
                updateStatus('Item moved');
            }
        });

        // Benchmark selection
        document.addEventListener('DOMContentLoaded', () => {
            const benchmarkItems = document.querySelectorAll('.benchmark-item');
            benchmarkItems.forEach(item => {
                item.addEventListener('click', () => {
                    benchmarkItems.forEach(b => b.classList.remove('selected'));
                    item.classList.add('selected');
                    selectedBenchmark = item.dataset.benchmark;
                    updateStatus(`Selected ${selectedBenchmark} benchmark`);
                });
            });
            
            initializeGrid();
        });

        function updateDisplay() {
            drawGrid();
            updateCoordinates();
            updateMachineCount();
        }

        function updateCoordinates() {
            const coordsDiv = document.getElementById('coordinates-display');
            const machineCoords = machines.map(m => `M${m.id}:(${m.x/gridSize},${m.y/gridSize})`).join(', ');
            const loadingCoords = loadingDock ? `(${loadingDock.x/gridSize},${loadingDock.y/gridSize})` : 'None';
            const unloadingCoords = unloadingDock ? `(${unloadingDock.x/gridSize},${unloadingDock.y/gridSize})` : 'None';
            
            coordsDiv.innerHTML = `
                <div><strong>Machines:</strong> ${machineCoords || 'None'}</div>
                <div><strong>Loading Dock:</strong> ${loadingCoords}</div>
                <div><strong>Unloading Dock:</strong> ${unloadingCoords}</div>
            `;
        }

        function updateMachineCount() {
            const countSpan = document.getElementById('machine-count');
            const loadingStatus = loadingDock ? '‚úÖ' : '‚ùå';
            const unloadingStatus = unloadingDock ? '‚úÖ' : '‚ùå';
            countSpan.textContent = `Machines: ${machines.length} | Loading Dock: ${loadingStatus} | Unloading Dock: ${unloadingStatus}`;
        }

        function updateStatus(message) {
            document.getElementById('status-text').textContent = message;
        }

        function generateDistanceMatrix() {
            if (machines.length === 0 || !loadingDock || !unloadingDock) {
                updateStatus('Error: Need at least 1 machine, loading dock, and unloading dock');
                return;
            }
            
            // Create entities array: [machines..., loadingDock, unloadingDock]
            const entities = [...machines, loadingDock, unloadingDock];
            const n = entities.length;
            const matrix = [];
            
            for (let i = 0; i < n; i++) {
                const row = [];
                for (let j = 0; j < n; j++) {
                    if (i === j) {
                        row.push(0);
                    } else {
                        // Manhattan distance
                        const entity1 = entities[i];
                        const entity2 = entities[j];
                        const distance = Math.abs(entity1.x/gridSize - entity2.x/gridSize) + 
                                       Math.abs(entity1.y/gridSize - entity2.y/gridSize);
                        row.push(distance);
                    }
                }
                matrix.push(row);
            }
            
            // Display matrix
            const matrixDiv = document.getElementById('distance-matrix-display');
            let matrixText = 'Distance Matrix:\n';
            matrixText += '# Last column: Unloading Dock\n';
            matrixText += '# Second last column: Loading Dock\n\n';
            
            matrix.forEach((row, i) => {
                matrixText += `[${row.map(val => val.toString().padStart(2)).join(', ')}]`;
                if (i < matrix.length - 1) matrixText += ',\n';
            });
            
            matrixDiv.innerHTML = `<pre>${matrixText}</pre>`;
            updateStatus(`Distance matrix generated (${n}x${n})`);
            
            return matrix;
        }

        function exportToGA() {
            if (!selectedBenchmark) {
                updateStatus('Error: Please select a benchmark first');
                return;
            }
            
            const matrix = generateDistanceMatrix();
            if (!matrix) return;
            
            const config = {
                benchmark: selectedBenchmark,
                numAMRs: parseInt(document.getElementById('num-amrs').value),
                gaParams: {
                    crossoverProb: parseFloat(document.getElementById('crossover-prob').value),
                    mutationProb: parseFloat(document.getElementById('mutation-prob').value),
                    populationSize: parseInt(document.getElementById('population-size').value),
                    terminationLimit: parseInt(document.getElementById('termination-limit').value),
                    stagnationLimit: parseInt(document.getElementById('stagnation-limit').value)
                },
                distanceMatrix: matrix,
                layout: {
                    machines: machines.map(m => ({id: m.id, x: m.x/gridSize, y: m.y/gridSize})),
                    loadingDock: {x: loadingDock.x/gridSize, y: loadingDock.y/gridSize},
                    unloadingDock: {x: unloadingDock.x/gridSize, y: unloadingDock.y/gridSize}
                }
            };
            
            // Create downloadable JSON file
            const dataStr = JSON.stringify(config, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `warehouse_config_${selectedBenchmark}_${Date.now()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            updateStatus(`Configuration exported: ${exportFileDefaultName}`);
            
            // Also display Python code snippet
            const pythonCode = `
# Python integration code:
import json
import numpy as np

# Load configuration
with open('${exportFileDefaultName}', 'r') as f:
    config = json.load(f)

# Create distance matrix
distance_matrix = np.array(config['distanceMatrix'])

# Initialize scheduler
scheduler = JobShopScheduler(
    machines=${machines.length}, 
    jobs=${machines.length}, 
    amrs=config['numAMRs'],
    population_size=config['gaParams']['populationSize'],
    crossover_prob=config['gaParams']['crossoverProb'],
    mutation_prob=config['gaParams']['mutationProb'],
    termination_limit=config['gaParams']['terminationLimit'],
    machine_data=machine_data_${selectedBenchmark.replace('x', '')},
    ptime_data=ptime_data_${selectedBenchmark.replace('x', '')}
)

# Set distance matrix
scheduler.set_distance_matrix(distance_matrix)

# Run optimization
result = scheduler.optimize()
            `;
            
            console.log('Python Integration Code:', pythonCode);
        }

        function clearLayout() {
            machines = [];
            machineCounter = 0;
            loadingDock = { x: 120, y: 120, type: 'loading' };
            unloadingDock = { x: 320, y: 120, type: 'unloading' };
            updateDisplay();
            updateStatus('Layout cleared');
            document.getElementById('distance-matrix-display').textContent = 'Distance matrix will appear here after generation...';
        }
    </script>
</body>
</html>